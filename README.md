This tutorial is a hello world sample.

The assumed stack is:

    Scala
    Sbt
    IntelliJ
    C++

We will also use the SBT-JNI plugin available here - https://github.com/jodersky/sbt-jni
Create a new project in IntelliJ

Choose JDK (1.8), Scala (2.12.6) and SBT (1.2.1).

Call it JNIHelloWorld.
Enable SBT-JNI

In project/plugins.sbt add the line:
addSbtPlugin("ch.jodersky" % "sbt-jni" % "<latest version>")

where <latest version> is replaced with the latest version number available here - https://bintray.com/jodersky/sbt-plugins/sbt-jni/ (currently 1.3.2).

Enable the plugin in your build.sbt file by adding a line like this:
enablePlugins(JniNative)

Make sure IntellilJ enables import and refreshes the build - a popup should appear to let you do this.
Writing Scala

First we need to write the function in Scala. Create a new class under src/main/scala and call it HelloWorld.

Mine looks like this.
import ch.jodersky.jni.nativeLoader
 
@nativeLoader("JNIHelloWorld0")
class HelloWorld {
  @native def helloFromC(): String
}


Run javah

javah is used to compile a header file that can be compiled with the rest of the C++ implementation to make it all work.

The sbt-jni plugin wraps the JDK javah command.
Configure jni-sbt Plugin

By default, calling sbt javah creates a header file in the target directory, while it would be more convenient to keep them in the source folder.

As Scala sources can be found under src/main/scala, Iâ€™ll keep my native implementation under src/main/native with generated headers under native/include.

SBT allows us to change this setting in our build file.

To redirect the generated output to the folder I need we need to add this line to our build.sbt file and reload the project.

target in javah := sourceDirectory.value / "native" / "include"


Once the project has reloaded, open the sbt shell in IntelliJ, and once it has initialised, type javah.

This generates a headerfile called HelloWorld.h which can be found in JNIHelloWorld/target/native/include.

The header file looks like this:
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class HelloWorld */
 
#ifndef _Included_HelloWorld
#define _Included_HelloWorld
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     HelloWorld
 * Method:    helloFromC
 * Signature: ()Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_HelloWorld_helloFromC
  (JNIEnv *, jobject);
 
#ifdef __cplusplus
}
#endif
#endif
C++ Implementation

In the sbt shell, run nativeInit Cmake.

This will create a new directory, JNIHelloWorld/src/native, and put a CMakeLists.txt file in there.

It might be useful to install a CMake syntax highlighting plugin in IntelliJ.

Create a new file in the native directory called HelloWorld.cpp

Put our hello worlding code in there.
// Save as "HelloJNI.cpp"
#include <jni.h>       // JNI header provided by JDK
#include <iostream>    // C++ standard IO header
#include <stdio.h>
#include <string>
#include "HelloWorld.h"  // Generated
using namespace std;
 
// Implementation of the native method sayHello()
JNIEXPORT jstring JNICALL Java_HelloWorld_helloFromC(JNIEnv *env, jobject thisObj) {
    printf("now we're running C++");
    string outCppStr = "Hello world from c++";
   return env->NewStringUTF(outCppStr.c_str());
}


Compile using CMake

Compile the c++ code using the CMake file you created earlier.

The name of the package is set here, and a project version is added to the library name. The default is 0. This needs to be added to your Scala code to load the correct library @nativeLoader("JNIHelloWorld0")
Run the code

In the sbt shell, run console to start a Scala console.
scala> val h = new HelloWorld
h: HelloWorld = HelloWorld@1aedb260
 
scala> h.helloFromC()
res0: String = Hello wold from c++





